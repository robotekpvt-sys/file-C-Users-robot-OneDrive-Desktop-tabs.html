<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Store Inventory</title>

<style>
body{
  margin:0;
  font-family: 'Segoe UI', Arial, sans-serif;
  background:#f2f2f2;
}
.container{
  display:flex;
  height:100vh;
}
.sidebar{
  width:240px;
  background:#fff;
  padding:15px;
  overflow-y:auto;
  border-right:1px solid #ccc;
}
.tab{
  padding:12px;
  margin-bottom:8px;
  cursor:pointer;
  border-radius:8px;
  border:1px solid #3F162A;
  background:#e6f2fb;
  font-weight:bold;
  font-size: 12px;
}
.tab.active{
  background:#3F162A;
  color:#fff;
}
.content{
  flex:1;
  padding:25px;
  overflow:auto;
}
.header-area {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}
#title {
  font-size: 22px;
  color: #333;
}

table{
  width: 100%;
  border-collapse: collapse;
  background:#fff;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}
th, td{
  border: 1px solid #ddd;
  padding: 12px 15px;
  text-align: left;
  font-size: 13px;
  white-space: nowrap; 
}
th{
  background: #4e86e4;
  color: #fff;
  font-weight: 600;
  text-transform: uppercase;
}

/* Column Widths Adjustments */
th:nth-child(1), td:nth-child(1) { width: 180px; } /* MODEL */
th:nth-child(2), td:nth-child(2) { min-width: 300px; } /* ITEMS */

tr:nth-child(even) {
  background-color: #f9f9f9;
}

.neg{
  color: #d9534f;
  font-weight:bold;
}

.export-btn {
  background: #3F162A;
  color: white;
  border: none;
  padding: 10px 18px;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
  font-size: 12px;
  transition: 0.3s;
}
.export-btn:hover {
  background: #5a203d;
}
</style>
</head>

<body>
<div class="container">
  <div class="sidebar" id="tabs"></div>
  <div class="content">
    <div class="header-area">
      <h2 id="title">Loading...</h2>
      <button class="export-btn" onclick="exportToCSV()">ðŸ“¥ EXPORT DATA</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>MODEL</th> 
          <th>ITEMS</th>
          <th>Qty</th>
          <th>Unit</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzMuSQ2ZByv82_a_1ihjcT0aJEHsMrhkaH2rQqUkLQHd6UuNm1TMjaMANjql2luPheZ/exec";

let data = [];
let categories = [];
let currentCategory = "";

fetch(API_URL)
  .then(r => r.json())
  .then(json => {
    data = json;
    categories = [...new Set(data.map(r => r.category))].sort();
    buildTabs();
    if(categories.length > 0) render(categories[0]);
  });

function buildTabs(){
  const tabBox = document.getElementById("tabs");
  tabBox.innerHTML = "";
  categories.forEach((cat, i) => {
    const div = document.createElement("div");
    div.className = "tab" + (i===0 ? " active":"");
    div.innerText = cat;
    div.onclick = () => {
      document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
      div.classList.add("active");
      render(cat);
    };
    tabBox.appendChild(div);
  });
}

function render(category){
  currentCategory = category;
  document.getElementById("title").innerText = category;
  const tbody = document.getElementById("tbody");
  
  const filteredData = data.filter(r => r.category === category);
  
  const htmlRows = filteredData.map(r => {
    let displayQty = isNaN(r.qty) ? r.qty : Number(r.qty).toLocaleString('en-IN', { maximumFractionDigits: 2 });

    return `
      <tr>
        <td>${r.brand}</td> 
        <td>${r.model}</td> 
        <td class="${r.qty < 0 ? 'neg':''}">
          ${displayQty}
        </td>
        <td>${r.unit}</td>
      </tr>
    `;
  }).join('');

  tbody.innerHTML = htmlRows;
}

function exportToCSV() {
  if (!currentCategory || data.length === 0) return;
  const filteredData = data.filter(r => r.category === currentCategory);
  const headers = ["MODEL", "ITEMS", "QTY", "UNIT"]; // CSV se bhi Category hata di
  const csvContent = [
    headers.join(','),
    ...filteredData.map(r => [`"${r.brand}"`,`"${r.model}"`,r.qty,`"${r.unit}"`].join(','))
  ].join('\n');
  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement("a");
  link.setAttribute("href", url);
  link.setAttribute("download", `Inventory_${currentCategory}.csv`);
  link.click();
}
</script>

</body>
</html>
